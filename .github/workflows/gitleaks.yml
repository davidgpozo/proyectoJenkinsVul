name: gitleaks
on: [pull_request, push, workflow_dispatch]
jobs:
  scan:
    name: gitleaks
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          token: ${{ secrets.PAT_ORGTARGET }}
      - name: try from source
        run: |
          cd ${{ github.WORKSPACE }}
          wget https://github.com/zricethezav/gitleaks/releases/download/v8.15.3/gitleaks_8.15.3_linux_x64.tar.gz
          tar -xvf gitleaks_8.15.3_linux_x64.tar.gz
          ls -lah
          chmod +x gitleaks
          ./gitleaks detect --redact -f json -v -r ${{ github.WORKSPACE }}/reporteGitLeaks || true
          ls -lah
      - name: Commit report
        run: |
          cd ${{ github.WORKSPACE }}
          git config --global user.name ${{ github.actor }}
          git add -f ${{ github.WORKSPACE }}/reporteGitLeaks
          git commit -m "Autometed push gitLeaks report"
          git push          
#      - name: Finding secrets
#        uses: gitleaks/gitleaks-action@v2
#        env:
#          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
